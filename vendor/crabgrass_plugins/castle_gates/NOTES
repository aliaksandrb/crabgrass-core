
TODO
--------------

remember to change

   p.integer :gate_bitfield, :default => 1



keyring_code
-------------

  sometimes they are strings and sometimes they are numbers. this is confusing.
  i think they should all be numbers for as long as possible and converted
  to strings just when needed as strings. (which i think is only when used
  for fulltext searching).

  i would like to see this field name changed to 'owner_code' or 'holder_code'


key
----------------

key.holder is very inefficient

  let say you are iterating over a set of locks and keys.
  each time, you probably call key.holder, which re-fetches the holder each time.

  ok, i made this a bunch better with @holder ||= xxx

label_for_holder(key.holder) is inefficient
  we want an object for key.holder so it can tell us its label
  which may depend on data.
  the problem is with associations. in order to get the object
  and call label on it, it fetches all the records in the association.

  i guess in resolve_holder{|code| User.find(id).friends }

make this go away
---------------------

ActsAsLocked::Key.resolve_holder do |code|
  if code < 10
    ActsAsLocked::Key.symbol_for(code)
  else
    string = code.to_s
    prefix = string.first
    id = string[1..-1].to_i
    case prefix.to_i
    when 1
      User.find(id)
    when 5
      Site.find(id)
    when 7
      User.find(id).friends
    when 8
      Group.find(id)
    when 9
      User.find(id).peers
    end
  end
end



associations
-------------------------


{@me.minions => :x} will trigger the association proxy @me.minions to automatically query all minions.

so we add @me.association(:minions) to manually get the proxy.


